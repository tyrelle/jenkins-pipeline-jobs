node ('local-mac'){
  stage 'Build'
      echo 'Reading config files'
      sh 'sleep 1s'


  stage 'Unit Tests'
    parallel (
      "eCatt Tests": {
        echo 'eCatt tests'
        git url: 'https://github.com/tyrelle/jenkins-pipeline-jobs.git', branch: 'master'
        checkout scm
        def returnCode = sh(script: 'groovy groovy-scripts/test.groovy', returnStatus: true)
        if (returnCode==1)
        {
          sh "exit 1"
        }

      },
      "SOAP UI Tests": {
        echo 'SOAP UI tests'
        sh "sleep 1s"
      }
    )

  stage 'QA Tests'
    echo 'QA Tests'
    sh "sleep 1s"

  stage 'Release Transports'
    echo 'Releasing Transports'
    sh "sleep 2s"

  stage 'L1 Approval'
    def userInput = input(
           id: 'userInput', message: 'Let\'s promote?', parameters: [
           [$class: 'TextParameterDefinition', defaultValue: 'uat', description: 'Environment', name: 'env'],
           [$class: 'hudson.model.PasswordParameterDefinition', defaultValue: 'uat1', description: 'Target', name: 'target']
          ])
    echo ("Env: "+userInput['env'])
    echo ("Target: "+userInput['target'])
    sh "sleep 2s"

  stage 'L2 Approval'
    input 'Give L2 Approvals?'
    sh "sleep 2s"

  stage 'Deployed to SIT1'
    echo 'Transports moving to SIT1'
    sh "sleep 2s"

  stage 'QA Tests'
    echo 'QA Tests'
    sh "sleep 4s"
}
